<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINNER'S</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nosifer&family=Eater&family=Cinzel:wght@400;700&family=MedievalSharp&family=UnifrakturMaguntia&family=IM+Fell+English+SC&display=swap" rel="stylesheet">
    <style>
        /* ===== ESTILOS SINNER'S - √ÅNGELES vs DEMONIOS ===== */
        :root {
            /* Colores demon√≠acos (iniciales) */
            --color-primario: #8b0000;
            --color-secundario: #DC143C;
            --color-acento: #ff4500;
            --color-texto: #ad8a1f;
            --color-fondo: #0a0a0a;
            --color-bordes: #DC143C;
            --sombra: 0 4px 15px rgba(255, 0, 0, 0.3);
            
            /* Fuentes demon√≠acas (iniciales) */
            --fuente-titulo: 'Nosifer', cursive;
            --fuente-subtitulo: 'Eater', cursive;
            --fuente-productos: 'Eater', cursive;
            --fuente-descripcion: 'MedievalSharp', cursive;
        }

        body.tema-angelical {
            /* Colores angelicales */
            --color-primario: #4169E1;
            --color-secundario: #1e90ff;
            --color-acento: #00bfff;
            --color-texto: #ad8a1f;
            --color-fondo: #0a0a0a;
            --color-bordes: #1e90ff;
            --sombra: 0 4px 15px rgba(255, 255, 255, 0.3);
            
            /* Fuentes angelicales */
            --fuente-titulo: 'UnifrakturMaguntia', cursive;
            --fuente-subtitulo: 'Cinzel', serif;
            --fuente-productos: 'IM Fell English SC', serif;
            --fuente-descripcion: 'MedievalSharp', cursive;
        }

        {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            min-height: 40px;
        }

        body {
            font-family: 'Cinzel', serif;
            color: white;
            line-height: 1.6;
            overflow-x: hidden;
            touch-action: manipulation;
            min-height: 100vh;
            padding-bottom: 80px;
            transition: all 0.5s ease;
        }

        /* Fondos diferentes para cada tema */
        body.tema-demoniaco {
            background: linear-gradient(to bottom, #0a0a0a, #600000, #8b0000);
        }

        body.tema-angelical {
            background: linear-gradient(to bottom, #0a0a0a, #1e3a8a, #4169E1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        /* Header para tema demon√≠aco */
        body.tema-demoniaco header {
            background: #000000;
            border-bottom: 3px solid #ff2a2a;
        }

        body.tema-demoniaco h1 {
            color: #ff2a2a;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        /* Header para tema angelical */
        body.tema-angelical header {
            background: #000000;
            border-bottom: 3px solid #ad8a1f;
        }

        body.tema-angelical h1 {
            color: #ad8a1f;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        h1 {
            font-family: var(--fuente-titulo);
            font-size: 3.5rem;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        /* BOT√ìN CARRITO */
        .carrito-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--color-texto);
            color: var(--color-fondo);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--sombra);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .carrito-btn:hover {
            transform: scale(1.1);
            background: var(--color-acento);
        }

        #contador {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--color-secundario);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* SECCIONES */
        section {
            margin-bottom: 40px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.7);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--color-bordes);
        }

        h2 {
            font-family: 'Eater', cursive;
            font-size: 2rem;
            color: var(--color-texto);
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-bordes);
        }

        body.tema-angelical h2 {
            font-family: 'Cinzel', serif;
            color: var(--color-texto);
            border-bottom: 2px solid var(--color-bordes);
        }

        /* PRODUCTOS */
        .productos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .producto-card {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--color-bordes);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .producto-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.2;
            pointer-events: none;
        }

        /* Colores espec√≠ficos para cada producto */
        .producto-card[data-producto="LEVIAT√ÅN"]::before {
            background: linear-gradient(45deg, #0000ff, #1e90ff);
        }

        .producto-card[data-producto="INFIERNO"]::before {
            background: linear-gradient(45deg, #8b0000, #ff0000);
        }

        .producto-card[data-producto="JALURIA"]::before {
            background: linear-gradient(45deg, #006400, #00ff00);
        }

        .producto-card[data-producto="ASMODEO"]::before {
            background: linear-gradient(45deg, #4b0082, #9400d3);
        }

        .producto-card[data-producto="IRA DIVINA"]::before {
            background: linear-gradient(45deg, #8b0000, #ff8c00);
        }

        .producto-card[data-producto="PACTUM"]::before {
            background: linear-gradient(45deg, #2f4f4f, #696969);
        }

        .producto-card[data-producto="REDENCI√ìN"]::before {
            background: linear-gradient(45deg, #000080, #0000ff);
        }

        .producto-card[data-producto="REVELACI√ìN"]::before {
            background: linear-gradient(45deg, #4b0082, #8a2be2);
        }

        .producto-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--sombra);
        }

        .producto-card h3 {
            font-family: var(--fuente-productos);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        /* Colores para nombres de productos en tema demon√≠aco */
        body.tema-demoniaco .producto-card h3 {
            color: #ff2a2a;
        }

        /* Colores para nombres de productos en tema angelical */
        body.tema-angelical .producto-card h3 {
            color: #1e90ff;
        }

        .producto-card p {
            font-family: var(--fuente-descripcion);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .precio {
            font-weight: bold;
            color: var(--color-texto);
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .btn-seleccionar {
            background: var(--color-texto);
            color: var(--color-fondo);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-seleccionar:hover {
            background: var(--color-acento);
            transform: scale(1.05);
        }

        /* COMBOS */
        .combos-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .combo-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--color-bordes);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            width: 280px;
            transition: all 0.3s ease;
        }

        .combo-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--sombra);
        }

        .combo-card h3 {
            font-family: 'Eater', cursive;
            color: var(--color-texto);
            margin-bottom: 15px;
        }

        body.tema-angelical .combo-card h3 {
            font-family: 'Cinzel', serif;
        }

        .combo-card p {
            margin-bottom: 15px;
            font-family: 'MedievalSharp', cursive;
        }

        /* FOOTER */
        footer {
            margin-top: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 2px solid var(--color-bordes);
            text-align: center;
        }

        .eslogan {
            font-family: 'Cinzel', serif;
            font-style: italic;
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--color-texto);
        }

        .copyright {
            font-family: 'MedievalSharp', cursive;
            margin-bottom: 20px;
            color: #ccc;
        }

        .info-footer p {
            margin-bottom: 10px;
            font-family: 'MedievalSharp', cursive;
        }

        body.tema-angelical footer {
            border-color: #1e90ff;
            background: rgba(65, 105, 225, 0.2);
        }

        body.tema-demoniaco footer {
            border-color: #dc143c;
            background: rgba(139, 0, 0, 0.3);
        }

        /* MODALES */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-contenido {
            background: linear-gradient(to bottom, var(--color-primario), var(--color-fondo));
            border: 2px solid var(--color-texto);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .cerrar-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--color-texto);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-titulo {
            font-family: 'Eater', cursive;
            color: var(--color-texto);
            margin-bottom: 20px;
            text-align: center;
        }

        body.tema-angelical .modal-titulo {
            font-family: 'Cinzel', serif;
        }

        .opcion-group {
            margin-bottom: 20px;
        }

        .opcion-group h3 {
            font-family: 'MedievalSharp', cursive;
            color: var(--color-texto);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .topping-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .topping-checkbox input {
            margin-right: 10px;
        }

        .topping-checkbox label {
            font-family: 'MedievalSharp', cursive;
            flex-grow: 1;
        }

        .topping-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .topping-price {
            color: var(--color-texto);
            font-weight: bold;
        }

        .botones-modal {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-confirmar {
            background: var(--color-texto);
            color: var(--color-fondo);
        }

        .btn-cancelar {
            background: var(--color-secundario);
            color: white;
        }

        .btn-modal:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }

        /* CARRITO */
        .item-carrito {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .item-info h4 {
            font-family: var(--fuente-productos);
            color: var(--color-texto);
            margin-bottom: 5px;
        }

        .detalles-variables {
            font-size: 0.8rem;
            color: #ccc;
            margin-bottom: 5px;
        }

        .precio-item {
            color: var(--color-texto);
            font-weight: bold;
        }

        .item-controles {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-controles button {
            background: var(--color-texto);
            color: var(--color-fondo);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        .carrito-vacio {
            text-align: center;
            padding: 20px;
            color: #ccc;
        }

        .total-carrito {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--color-texto);
            text-align: right;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 2px solid var(--color-texto);
        }

        /* ALERTA */
        .alerta-minimo {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-secundario);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            display: none;
            align-items: center;
            justify-content: space-between;
            z-index: 1100;
            box-shadow: var(--sombra);
            max-width: 90%;
}

        .cerrar-alerta {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 15px;
        }

        /* EFECTOS */
        .pulse-effect {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .modal-oculto {
            display: none;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .productos-grid {
                grid-template-columns: 1fr;
            }
            
            .combos-container {
                flex-direction: column;
                align-items: center;
            }
            
            .combo-card {
                width: 100%;
                max-width: 280px;
            }
            
            .modal-contenido {
                padding: 20px;
            }
        }
    </style>
</head>
<body class="tema-demoniaco">
    <div class="container">
        <header id="cambiador-tema">
            <h1>SINNER'S</h1>
        </header>

        <!-- Alerta de pedido m√≠nimo (oculta por defecto) -->
        <div class="alerta-minimo" id="alerta-minimo">
            <div>
                <strong>PEDIDO M√çNIMO</strong>
                <p>No aceptamos pedidos con menos de 3 productos. Agrega m√°s items para continuar.</p>
            </div>
            <button class="cerrar-alerta" id="cerrar-alerta">&times;</button>
        </div>

        <!-- Bebidas del Pecado -->
        <section>
            <h2>BEBIDAS DEL PECADO</h2>
            <div class="productos-grid" id="bebidas-container">
                <!-- Los productos se cargar√°n con JavaScript -->
            </div>
        </section>

        <!-- Caf√©s Malditos -->
        <section>
            <h2>CAF√âS MALDITOS</h2>
            <div class="productos-grid" id="cafes-container">
                <!-- Los productos se cargar√°n con JavaScript -->
            </div>
        </section>

        <!-- T√©s Oscuros -->
        <section>
            <h2>T√âS OSCUROS</h2>
            <div class="productos-grid" id="tes-container">
                <!-- Los productos se cargar√°n con JavaScript -->
            </div>
        </section>

        <!-- Combos -->
        <section>
            <h2>PECADOS RECOMENDADOS</h2>
            <div class="combos-container">
                <div class="combo-card" id="combo-demoniaco">
                    <h3>TRINIDAD DEL INFIERNO</h3>
                    <p>INFERNO + ASMODEO + REVELACI√ìN</p>
                    <p class="precio">$120.00 MXN</p>
                    <button class="btn-seleccionar" onclick="seleccionarCombo('demonios')">SELECCIONAR COMBO</button>
                </div>
                <div class="combo-card" id="combo-angelical" style="display:none;">
                    <h3>SANT√çSIMA TRINIDAD</h3>
                    <p>LEVIAT√ÅN + JALURIA + REDENCI√ìN</p>
                    <p class="precio">$120.00 MXN</p>
                    <button class="btn-seleccionar" onclick="seleccionarCombo('angeles')">SELECCIONAR COMBO</button>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="info-footer">
                <p class="eslogan">"Donde los pecados tienen sabor y las virtudes tienen precio"</p>
                <p class="copyright">¬© 2023 Sinner's - Todos los derechos reservados</p>
                
            </div>
        </footer>
    </div>

    <!-- Bot√≥n de carrito flotante -->
    <button class="carrito-btn" id="carrito-btn">
        <i class="fas fa-shopping-cart"></i>
        <span id="contador">0</span>
    </button>

    <!-- Modal de opciones de producto -->
    <div class="modal modal-oculto" id="modal-opciones">
        <div class="modal-contenido">
            <button class="cerrar-modal" id="cerrar-opciones">&times;</button>
            <h2 class="modal-titulo" id="titulo-modal">Personalizar Producto</h2>
            <p><strong>Sabor:</strong> <span id="sabor-destacado"></span></p>
            <div id="formulario-opciones"></div>
            <div class="botones-modal">
                <button class="btn-modal btn-cancelar" id="regresar-modal">CANCELAR</button>
                <button class="btn-modal btn-confirmar" id="confirmar-opciones">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <!-- Modal de carrito -->
    <div class="modal modal-oculto" id="modal-carrito">
        <div class="modal-contenido">
            <button class="cerrar-modal" id="cerrar-carrito">&times;</button>
            <h2 class="modal-titulo">TU CARRITO DE PECADOS</h2>
            <div id="lista-carrito"></div>
            <p class="total-carrito" id="total-carrito">Total: $0.00 MXN</p>
            <div class="botones-modal">
                <button class="btn-modal btn-cancelar" id="seguir-pidiendo">SEGUIR PIDIENDO</button>
                <button class="btn-modal btn-confirmar" id="whatsapp-btn">FINALIZAR PEDIDO</button>
            </div>
        </div>
    </div>

    <!-- Modal de ubicaci√≥n -->
    <div class="modal modal-oculto" id="modal-ubicacion">
        <div class="modal-contenido">
            <button class="cerrar-modal" id="cerrar-ubicacion">&times;</button>
            <h2 class="modal-titulo">SELECCIONAR UBICACI√ìN</h2>
            <p>Selecciona tu ubicaci√≥n de entrega:</p>
            <div class="opcion-group">
                <div class="topping-checkbox">
                    <input type="radio" name="ubicacion" value="Calle Coral 120, colonia Estrella, CDMX" id="ubicacion-principal" data-horarios="Lunes a Domingo: 15:00 - 21:00 horas" data-enlace="https://maps.app.goo.gl/" checked>
                    <label for="ubicacion-principal">
                        <div class="topping-info">
                            <span class="topping-name">Calle Coral 120, colonia Estrella, CDMX</span>
                        </div>
                        <div class="ubicacion-horario">Lunes a Domingo: 15:00 - 21:00 horas</div>
                    </label>
                </div>

                <div class="topping-checkbox">
                    <input type="radio" name="ubicacion" value="C. Granate 65, Col. Estrella, Gustavo A. Madero, 07810 Ciudad de M√©xico, CDMX" id="ubicacion-melimarel" data-horarios="Lunes a Viernes: 16:00 - 20:00 horas | S√°bados y Domingos: 15:00 - 20:00 horas" data-enlace="https://maps.app.goo.gl/atimprCAANEjpomd9">
                    <label for="ubicacion-melimarel">
                        <div class="topping-info">
                            <span class="topping-name">PAPELER√çA MELIMAREL</span>
                        </div>
                        <div class="ubicacion-horario">Lunes a Viernes: 16:00 - 20:00 horas | S√°bados y Domingos: 15:00 - 20:00 horas</div>
                        <div class="ubicacion-enlace"><a href="https://maps.app.goo.gl/atimprCAANEjpomd9" target="_blank">Ver en Google Maps</a></div>
                    </label>
                </div>

                <div class="topping-checkbox">
                    <input type="radio" name="ubicacion" value="Esquina Turquesa, Joyas, Col. Estrella, 07810 Ciudad de M√©xico" id="ubicacion-doris" data-horarios="Lunes a Viernes: 16:00 - 20:00 horas | S√°bados: 14:00 - 20:00 horas | Domingos: Cerrado" data-enlace="https://maps.app.goo.gl/VBgoAktyau8u5XZj6">
                    <label for="ubicacion-doris">
                        <div class="topping-info">
                            <span class="topping-name">DISTRIBUIDOR ACCESORIOS MOVILES DORIS</span>
                        </div>
                        <div class="ubicacion-horario">Lunes a Viernes: 16:00 - 20:00 horas | S√°bados: 14:00 - 20:00 horas | Domingos: Cerrado</div>
                        <div class="ubicacion-enlace"><a href="https://maps.app.goo.gl/VBgoAktyau8u5XZj6" target="_blank">Ver en Google Maps</a></div>
                    </label>
                </div>
            </div>
            <div class="botones-modal">
                <button class="btn-modal btn-cancelar" id="cancelar-ubicacion">CANCELAR</button>
                <button class="btn-modal btn-confirmar" id="confirmar-ubicacion">CONFIRMAR UBICACI√ìN</button>
            </div>
        </div>
    </div>

    <!-- Modal de combo -->
    <div class="modal modal-oculto" id="modal-combo">
        <div class="modal-contenido">
            <button class="cerrar-modal" id="cerrar-combo">&times;</button>
            <h2 class="modal-titulo" id="titulo-combo">Personalizar Combo</h2>
            <div id="opciones-combo"></div>
            <div class="botones-modal">
                <button class="btn-modal btn-cancelar" id="regresar-combo">CANCELAR</button>
                <button class="btn-modal btn-confirmar" id="confirmar-combo">CONFIRMAR COMBO</button>
            </div>
        </div>
    </div>

    <!-- Modal de pago -->
    <div class="modal modal-oculto" id="modal-pago">
        <div class="modal-contenido">
            <button class="cerrar-modal" id="cerrar-pago">&times;</button>
            <h2 class="modal-titulo">INSTRUCCIONES DE PAGO</h2>
            <p>Para completar tu pedido, realiza una transferencia a:</p>
            <p><strong>Banco:</strong> BBVA</p>
            <p><strong>Titular:</strong> Eric Daniel Guti√©rrez Arana</p>
            <p><strong>CLABE:</strong> 012 261 01584933343 3</p>
             <p><strong>COMPROBANTE DE PAGO:</strong>Al momento de realizar el pedido se confirmar√° la preparaci√≥n del mismo una vez que se adjunte el comprobante de pago; en el CONCEPTO de la transferencia COLOCA TU NOMBRE o el NOMBRE DE LA PERSONA que realizar√° la recolecci√≥n</p>
            <p>Una vez realizado el pago, haz clic en el bot√≥n de abajo para enviar tu pedido por WhatsApp con el comprobante.</p>
            <p id="direccion-confirmacion">üìç Calle Coral 120, colonia Estrella, CDMX</p>
            <div class="botones-modal">
                <button class="btn-modal btn-cancelar" id="regresar-direccion">CAMBIAR DIRECCI√ìN</button>
                <button class="btn-modal btn-confirmar" id="confirmar-pedido">ENVIAR POR WHATSAPP</button>
            </div>
        </div>
    </div>
    <script>
        // Datos de productos con toppings corregidos
        const productos = {
            bebidas: [
                { 
                    id: 1, 
            nombre: "LEVIAT√ÅN", 
            descripcion: "Sum√©rgete en las profundidades de la tentaci√≥n azul oscura. Sabor a mora azul que te arrastrar√° al abismo. (475ml)",
            sabor: "Mora azul", 
            precio: 50, 
            toppings: [
                { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                { nombre: "Elixir Prohibido (Vodka 2.5 oz)", precio: 15 }
            ]
        },
        { 
            id: 2, 
            nombre: "INFIERNO", 
            descripcion: "Pasi√≥n ardiente con sabor a frutos rojos. (475ml)",
            sabor: "Frutos rojos", 
            precio: 50, 
            toppings: [
                { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                { nombre: "Elixir Prohibido (Ron Blanco 2.5 oz)", precio: 15 }
            ]
        },
        { 
            id: 3, 
            nombre: "JALURIA", 
            descripcion: "Entre m√°s lo resistes m√°s deseas probar su sabor a manzana verde. (475ml)",
            sabor: "Manzana verde", 
            precio: 50, 
            toppings: [
                { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                { nombre: "Elixir Prohibido (Ron Blanco 2.5 oz)", precio: 15 }
            ]
        },
        { 
            id: 4, 
            nombre: "ASMODEO", 
            descripcion: "Te har√° sentir la lujuria en un sorbo por su sabor a frutos del bosque. (475ml)",
            sabor: "Frutos del bosque", 
            precio: 50, 
            toppings: [
                { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                { nombre: "Elixir Prohibido (Vodka 1.5 oz/Ron Blanco 1 oz)", precio: 15 }
            ]
        }
    ],
    cafes: [
        { 
            id: 5, 
            nombre: "IRA DIVINA", 
            descripcion: "Energ√≠a Divina toma un Caf√© Cold Brew. (475ml)",
            sabor: "Caf√©", 
            precio: 40, 
            opciones: {
                "LECHE": ["Normal", "Deslactosada (+$10)"],
                "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
            },
            toppings: [
                { nombre: "Gemas del Infierno (Coffee Jelly)", precio: 15 }
            ]
        },
        { 
            id: 6, 
            nombre: "PACTUM", 
            descripcion: "Pacto divino, tranquil@ solo es un suave Cold Brew descafeinado. (475ml)",
            sabor: "Caf√© descafeinado", 
            precio: 40, 
            opciones: {
                "LECHE": ["Normal", "Deslactosada (+$10)"],
                "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
            },
            toppings: [
                { nombre: "Gemas del Infierno (Coffee Jelly)", precio: 15 }
            ]
        }
    ],
    tes: [
        { 
            id: 7, 
            nombre: "REDENCI√ìN", 
            descripcion: "Todos la buscamos, y todos la necesitamos. Cold Brew Tea. (475ml)",
            sabor: "T√© negro, T√© verde, T√© de frutos del bosque, T√© de Jamaica (pregunta por la disponibilidad de tu selecci√≥n)", 
            precio: 35, 
            opciones: {
                "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
            },
            toppings: [
                { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 }
            ]
        },
        { 
            id: 8, 
            nombre: "REVELACI√ìN", 
            descripcion: "El misterio se devela hoy. ¬øSer√° tu salvaci√≥n o tu perdici√≥n? Atr√©vete a conocer el veredicto. Bebida refrescante del d√≠a. (475ml)",
            sabor: "Bebida sorpresa del d√≠a",  
                    precio: 35, 
                    opciones: {
                        "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
                    },
                    toppings: [
                        { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 }
                    ]
                }
            ]
        };

        // Datos de combos
        const combos = {
            demonios: {
                nombre: "TRINIDAD DEL INFIERNO",
                productos: ["INFIERNO", "ASMODEO", "REVELACI√ìN"],
                precioBase: 120,
                descripcion: "INFERNO + ASMODEO + REVELACI√ìN"
            },
            angeles: {
                nombre: "SANT√çSIMA TRINIDAD",
                productos: ["LEVIAT√ÅN", "JALURIA", "REDENCI√ìN"],
                precioBase: 120,
                descripcion: "LEVIAT√ÅN + JALURIA + REDENCI√ìN"
            }
        };

        // Variables globales
        let carrito = [];
        let productoSeleccionado = null;
        let opcionesSeleccionadas = {};
        let comboSeleccionado = null;
        let opcionesComboSeleccionadas = {};
        let direccionSeleccionada = "";

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarProductos();
            cargarCarritoDesdeLocalStorage();
            actualizarCarrito();
            configurarEventos();
        });

        // Configurar eventos
        function configurarEventos() {
            // Cambio de tema al hacer clic en el t√≠tulo
            document.getElementById('cambiador-tema').addEventListener('click', cambiarTema);
            
            // Bot√≥n carrito
            document.getElementById('carrito-btn').addEventListener('click', abrirModalCarrito);
            
            // Cerrar modales
            document.getElementById('cerrar-opciones').addEventListener('click', cerrarModalOpciones);
            document.getElementById('cerrar-carrito').addEventListener('click', cerrarModalCarrito);
            document.getElementById('cerrar-ubicacion').addEventListener('click', cerrarModalUbicacion);
            document.getElementById('cerrar-combo').addEventListener('click', cerrarModalCombo);
            document.getElementById('cerrar-pago').addEventListener('click', cerrarModalPago);
            document.getElementById('cerrar-alerta').addEventListener('click', function() {
                document.getElementById('alerta-minimo').style.display = 'none';
            });
            
            // Botones de modales
            document.getElementById('regresar-modal').addEventListener('click', cerrarModalOpciones);
            document.getElementById('confirmar-opciones').addEventListener('click', confirmarSeleccion);
            document.getElementById('seguir-pidiendo').addEventListener('click', cerrarModalCarrito);
            document.getElementById('whatsapp-btn').addEventListener('click', mostrarSeleccionUbicacion);
            document.getElementById('regresar-carrito').addEventListener('click', cerrarModalUbicacion);
            document.getElementById('confirmar-ubicacion').addEventListener('click', mostrarInstruccionesPago);
            document.getElementById('regresar-combo').addEventListener('click', cerrarModalCombo);
            document.getElementById('confirmar-combo').addEventListener('click', confirmarCombo);
            document.getElementById('abrir-maps').addEventListener('click', abrirGoogleMaps);
            document.getElementById('regresar-direccion').addEventListener('click', regresarADireccion);
            document.getElementById('confirmar-pedido').addEventListener('click', enviarPedidoWhatsApp);
            
            // Cerrar modales al hacer clic fuera
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('modal-oculto');
                    }
                });
            });
        }

        // Cambiar entre temas
        function cambiarTema() {
            const body = document.body;
            
            if (body.classList.contains('tema-demoniaco')) {
                body.classList.remove('tema-demoniaco');
                body.classList.add('tema-angelical');
                document.getElementById('combo-demoniaco').style.display = 'none';
                document.getElementById('combo-angelical').style.display = 'block';
            } else {
                body.classList.remove('tema-angelical');
                body.classList.add('tema-demoniaco');
                document.getElementById('combo-demoniaco').style.display = 'block';
                document.getElementById('combo-angelical').style.display = 'none';
            }
        }

        // Cargar productos en la interfaz
        function cargarProductos() {
            for (const categoria in productos) {
                const contenedor = document.getElementById(`${categoria}-container`);
                if (contenedor) {
                    productos[categoria].forEach(producto => {
                        const elementoProducto = crearElementoProducto(producto);
                        contenedor.appendChild(elementoProducto);
                    });
                }
            }
        }

        // Crear elemento de producto
        function crearElementoProducto(producto) {
            const div = document.createElement('div');
            div.className = 'producto-card';
            div.setAttribute('data-producto', producto.nombre);
            div.innerHTML = `
                <h3 data-producto="${producto.nombre}">${producto.nombre}</h3>
                <p>${producto.descripcion}</p>
                <p class="precio">$${producto.precio}.00 MXN</p>
                <button class="btn-seleccionar">SELECCIONAR PECADO</button>
            `;
            
            // Asignar evento al bot√≥n
            const boton = div.querySelector('.btn-seleccionar');
            boton.addEventListener('click', () => seleccionarProducto(producto));
            
            return div;
        }

        // Seleccionar producto para personalizar
        function seleccionarProducto(producto) {
            productoSeleccionado = producto;
            opcionesSeleccionadas = {};
            mostrarModalOpciones();
        }

        // Mostrar modal de opciones
        function mostrarModalOpciones() {
            const modal = document.getElementById('modal-opciones');
            const tituloModal = document.getElementById('titulo-modal');
            const saborDestacado = document.getElementById('sabor-destacado');
            const formulario = document.getElementById('formulario-opciones');
            
            tituloModal.textContent = `Personalizar ${productoSeleccionado.nombre}`;
            saborDestacado.textContent = `Sabor: ${productoSeleccionado.sabor}`;
            formulario.innerHTML = '';
            
            // Crear opciones personalizables (para caf√©s y t√©s)
            if (productoSeleccionado.opciones) {
                for (const [opcion, valores] of Object.entries(productoSeleccionado.opciones)) {
                    const opcionGroup = document.createElement('div');
                    opcionGroup.className = 'opcion-group';
                    opcionGroup.innerHTML = `<h3>${opcion}</h3>`;
                    
                    valores.forEach((valor, index) => {
                        const inputId = `opcion-${opcion}-${index}`;
                        
                        const div = document.createElement('div');
                        div.className = 'topping-checkbox';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = opcion;
                        radio.value = valor;
                        radio.id = inputId;
                        radio.checked = index === 0;
                        
                        radio.addEventListener('change', function() {
                            opcionesSeleccionadas[opcion] = valor;
                        });
                        
                        const label = document.createElement('label');
                        label.htmlFor = inputId;
                        label.textContent = valor.replace('(+$10)', '').trim();
                        
                        // Mostrar precio si existe
                        if (valor.includes('+$10')) {
                            const priceSpan = document.createElement('span');
                            priceSpan.className = 'topping-price';
                            priceSpan.textContent = '+$10';
                            label.appendChild(priceSpan);
                        }
                        
                        div.appendChild(radio);
                        div.appendChild(label);
                        opcionGroup.appendChild(div);
                    });
                    
                    formulario.appendChild(opcionGroup);
                    // Establecer valor por defecto
                    opcionesSeleccionadas[opcion] = valores[0].replace('(+$10)', '').trim();
                }
            }
            
            // Crear checkboxes para toppings (para todas las bebidas)
            if (productoSeleccionado.toppings && productoSeleccionado.toppings.length > 0) {
                const toppingsGroup = document.createElement('div');
                toppingsGroup.className = 'opcion-group';
                toppingsGroup.innerHTML = `<h3>TOPPINGS</h3>`;
                
                // Opci√≥n sin topping
                const sinToppingDiv = document.createElement('div');
                sinToppingDiv.className = 'topping-checkbox';
                
                const radioSin = document.createElement('input');
                radioSin.type = 'radio';
                radioSin.name = 'topping';
                radioSin.value = 'sin';
                radioSin.id = 'topping-sin';
                radioSin.checked = true;
                
                radioSin.addEventListener('change', function() {
                    if (this.checked) {
                        // Desmarcar todos los checkboxes de toppings
                        document.querySelectorAll('input[type="checkbox"][name="toppings"]').forEach(cb => {
                            cb.checked = false;
                        });
                        opcionesSeleccionadas.toppings = [];
                    }
                });
                
                const labelSin = document.createElement('label');
                labelSin.htmlFor = 'topping-sin';
                labelSin.textContent = 'Sin topping';
                
                sinToppingDiv.appendChild(radioSin);
                sinToppingDiv.appendChild(labelSin);
                toppingsGroup.appendChild(sinToppingDiv);
                
                // Opciones de toppings
                productoSeleccionado.toppings.forEach((topping, index) => {
                    const toppingDiv = document.createElement('div');
                    toppingDiv.className = 'topping-checkbox';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'toppings';
                    checkbox.value = topping.nombre;
                    checkbox.id = `topping-${index}`;
                    
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            // Desmarcar "Sin topping"
                            document.getElementById('topping-sin').checked = false;
                            
                            // Agregar topping a las opciones seleccionadas
                            if (!opcionesSeleccionadas.toppings) {
                                opcionesSeleccionadas.toppings = [];
                            }
                            opcionesSeleccionadas.toppings.push(topping.nombre);
                        } else {
                            // Remover topping de las opciones seleccionadas
                            if (opcionesSeleccionadas.toppings) {
                                const index = opcionesSeleccionadas.toppings.indexOf(topping.nombre);
                                if (index > -1) {
                                    opcionesSeleccionadas.toppings.splice(index, 1);
                                }
                                
                                // Si no hay toppings seleccionados, marcar "Sin topping"
                                if (opcionesSeleccionadas.toppings.length === 0) {
                                    document.getElementById('topping-sin').checked = true;
                                }
                            }
                        }
                    });
                    
                    const label = document.createElement('label');
                    label.htmlFor = `topping-${index}`;
                    
                    const toppingInfo = document.createElement('div');
                    toppingInfo.className = 'topping-info';
                    
                    const toppingName = document.createElement('span');
                    toppingName.className = 'topping-name';
                    toppingName.textContent = topping.nombre;
                    
                    const toppingPrice = document.createElement('span');
                    toppingPrice.className = 'topping-price';
                    toppingPrice.textContent = `+$${topping.precio}`;
                    
                    toppingInfo.appendChild(toppingName);
                    toppingInfo.appendChild(toppingPrice);
                    label.appendChild(toppingInfo);
                    
                    toppingDiv.appendChild(checkbox);
                    toppingDiv.appendChild(label);
                    toppingsGroup.appendChild(toppingDiv);
                });
                
                formulario.appendChild(toppingsGroup);
                // Establecer valor por defecto
                opcionesSeleccionadas.toppings = [];
            }
            
            modal.classList.remove('modal-oculto');
        }

                // Cerrar modal de opciones
        function cerrarModalOpciones() {
            document.getElementById('modal-opciones').classList.add('modal-oculto');
        }

        // Confirmar selecci√≥n y agregar al carrito
        function confirmarSeleccion() {
            // Calcular precio adicional por opciones
            let precioAdicional = 0;
            let detallesVariables = [];
            
            // Procesar opciones de caf√©s y t√©s
            for (const [opcion, valor] of Object.entries(opcionesSeleccionadas)) {
                if (opcion !== 'toppings') {
                    if (valor.includes('Deslactosada')) precioAdicional += 10;
                    
                    // Guardar detalles para mostrar en carrito
                    if (valor.includes('Deslactosada')) {
                        detallesVariables.push(`${opcion}: ${valor}`);
                    }
                }
            }
            
            // Procesar toppings
            if (opcionesSeleccionadas.toppings && opcionesSeleccionadas.toppings.length > 0) {
                opcionesSeleccionadas.toppings.forEach(toppingNombre => {
                    // Encontrar el topping para obtener su precio
                    const topping = productoSeleccionado.toppings.find(t => t.nombre === toppingNombre);
                    if (topping) {
                        precioAdicional += topping.precio;
                        detallesVariables.push(`Topping: ${topping.nombre}`);
                    }
                });
            }
            
            const precioTotal = productoSeleccionado.precio + precioAdicional;
            
            const itemCarrito = {
                ...productoSeleccionado,
                opciones: {...opcionesSeleccionadas},
                cantidad: 1,
                precioTotal: precioTotal,
                detallesVariables: detallesVariables
            };
            
            // Verificar si ya existe en el carrito
            const indexExistente = carrito.findIndex(item => 
                item.id === itemCarrito.id && 
                JSON.stringify(item.opciones) === JSON.stringify(itemCarrito.opciones)
            );
            
            if (indexExistente !== -1) {
                carrito[indexExistente].cantidad++;
                carrito[indexExistente].precioTotal += precioTotal;
            } else {
                carrito.push(itemCarrito);
            }
            
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            cerrarModalOpciones();
            
            // Efecto visual de confirmaci√≥n
            const carritoBtn = document.getElementById('carrito-btn');
            carritoBtn.classList.add('pulse-effect');
            setTimeout(() => {
                carritoBtn.classList.remove('pulse-effect');
            }, 500);
        }

        // Guardar carrito en localStorage
        function guardarCarritoEnLocalStorage() {
            localStorage.setItem('sinnerCart', JSON.stringify(carrito));
        }

        // Cargar carrito desde localStorage
        function cargarCarritoDesdeLocalStorage() {
            const carritoGuardado = localStorage.getItem('sinnerCart');
            if (carritoGuardado) {
                carrito = JSON.parse(carritoGuardado);
            }
        }

        // Actualizar carrito
        function actualizarCarrito() {
            const contador = document.getElementById('contador');
            contador.textContent = carrito.reduce((total, item) => total + item.cantidad, 0);
        }

        // Abrir modal de carrito
        function abrirModalCarrito() {
            const modal = document.getElementById('modal-carrito');
            const listaCarrito = document.getElementById('lista-carrito');
            const totalCarrito = document.getElementById('total-carrito');
            
            listaCarrito.innerHTML = '';
            
            if (carrito.length === 0) {
                listaCarrito.innerHTML = '<p class="carrito-vacio">Tu carrito est√° vac√≠o</p>';
                totalCarrito.textContent = 'Total: $0.00 MXN';
            } else {
                let total = 0;
                
                carrito.forEach((item, index) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item-carrito';
                    
                    let detallesHTML = '';
                    if (item.detallesVariables && item.detallesVariables.length > 0) {
                        detallesHTML = `<div class="detalles-variables">`;
                        item.detallesVariables.forEach(detalle => {
                            detallesHTML += `<div>${detalle}</div>`;
                        });
                        detallesHTML += `</div>`;
                    }
                    
                    itemElement.innerHTML = `
                        <div class="item-info">
                            <h4>${item.nombre}</h4>
                            ${detallesHTML}
                            <p class="precio-item">$${item.precioTotal}.00 MXN</p>
                        </div>
                        <div class="item-controles">
                            <button onclick="modificarCantidad(${index}, -1)">-</button>
                            <span>${item.cantidad}</span>
                            <button onclick="modificarCantidad(${index}, 1)">+</button>
                            <button onclick="eliminarItem(${index})">üóëÔ∏è</button>
                        </div>
                    `;
                    listaCarrito.appendChild(itemElement);
                    total += item.precioTotal;
                });
                
                totalCarrito.textContent = `Total: $${total}.00 MXN`;
            }
            
            modal.classList.remove('modal-oculto');
        }

        // Cerrar modal de carrito
        function cerrarModalCarrito() {
            document.getElementById('modal-carrito').classList.add('modal-oculto');
        }

        // Modificar cantidad de items en carrito
        function modificarCantidad(index, cambio) {
            const item = carrito[index];
            const precioUnitario = item.precioTotal / item.cantidad;
            
            if (cambio === 1) {
                item.cantidad++;
                item.precioTotal += precioUnitario;
            } else if (cambio === -1 && item.cantidad > 1) {
                item.cantidad--;
                item.precioTotal -= precioUnitario;
            }
            
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            abrirModalCarrito(); // Refrescar vista
        }

        // Eliminar item del carrito
        function eliminarItem(index) {
            carrito.splice(index, 1);
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            
            if (carrito.length === 0) {
                cerrarModalCarrito();
            } else {
                abrirModalCarrito(); // Refrescar vista
            }
        }

        // Seleccionar combo
        function seleccionarCombo(tipo) {
            comboSeleccionado = combos[tipo];
            opcionesComboSeleccionadas = {};
            mostrarModalCombo();
        }

        // Mostrar modal de combo
        function mostrarModalCombo() {
            const modal = document.getElementById('modal-combo');
            const tituloCombo = document.getElementById('titulo-combo');
            const opcionesCombo = document.getElementById('opciones-combo');
            
            tituloCombo.textContent = `Personalizar ${comboSeleccionado.nombre}`;
            opcionesCombo.innerHTML = '';
            
            // Crear opciones para cada producto del combo
            comboSeleccionado.productos.forEach(nombreProducto => {
                // Buscar el producto en los datos
                let producto = null;
                for (const categoria in productos) {
                    producto = productos[categoria].find(p => p.nombre === nombreProducto);
                    if (producto) break;
                }
                
                if (producto) {
                    const productoGroup = document.createElement('div');
                    productoGroup.className = 'opcion-group';
                    productoGroup.innerHTML = `<h3>${producto.nombre} (${producto.sabor})</h3>`;
                    
                    // Mostrar opciones para caf√©s and t√©s
                    if (producto.opciones) {
                        for (const [opcion, valores] of Object.entries(producto.opciones)) {
                            valores.forEach((valor, index) => {
                                const inputId = `combo-${producto.nombre}-${opcion}-${index}`;
                                
                                const div = document.createElement('div');
                                div.className = 'topping-checkbox';
                                
                                const radio = document.createElement('input');
                                radio.type = 'radio';
                                radio.name = `${producto.nombre}-${opcion}`;
                                radio.value = valor;
                                radio.id = inputId;
                                radio.checked = index === 0;
                                
                                radio.addEventListener('change', function() {
                                    if (!opcionesComboSeleccionadas[producto.nombre]) {
                                        opcionesComboSeleccionadas[producto.nombre] = {};
                                    }
                                    opcionesComboSeleccionadas[producto.nombre][opcion] = valor;
                                });
                                
                                const label = document.createElement('label');
                                label.htmlFor = inputId;
                                label.textContent = valor.replace('(+$10)', '').trim();
                                
                                                // Mostrar precio si existe
                if (valor.includes('+$10')) {
                    const priceSpan = document.createElement('span');
                    priceSpan.className = 'topping-price';
                    priceSpan.textContent = '+$10';
                    label.appendChild(priceSpan);
                }
                
                div.appendChild(radio);
                div.appendChild(label);
                opcionGroup.appendChild(div);
            });
            
            formulario.appendChild(opcionGroup);
            // Establecer valor por defecto
            opcionesSeleccionadas[opcion] = valores[0].replace('(+$10)', '').trim();
        }
    }
    
    // Crear checkboxes para toppings (para todas las bebidas)
    if (productoSeleccionado.toppings && productoSeleccionado.toppings.length > 0) {
        const toppingsGroup = document.createElement('div');
        toppingsGroup.className = 'opcion-group';
        toppingsGroup.innerHTML = `<h3>TOPPINGS</h3>`;
        
        // Opci√≥n sin topping
        const sinToppingDiv = document.createElement('div');
        sinToppingDiv.className = 'topping-checkbox';
        
        const radioSin = document.createElement('input');
        radioSin.type = 'radio';
        radioSin.name = 'topping';
        radioSin.value = 'sin';
        radioSin.id = 'topping-sin';
        radioSin.checked = true;
        
        radioSin.addEventListener('change', function() {
            if (this.checked) {
                // Desmarcar todos los checkboxes de toppings
                document.querySelectorAll('input[type="checkbox"][name="toppings"]').forEach(cb => {
                    cb.checked = false;
                });
                opcionesSeleccionadas.toppings = [];
            }
        });
        
        const labelSin = document.createElement('label');
        labelSin.htmlFor = 'topping-sin';
        labelSin.textContent = 'Sin topping';
        
        sinToppingDiv.appendChild(radioSin);
        sinToppingDiv.appendChild(labelSin);
        toppingsGroup.appendChild(sinToppingDiv);
        
        // Opciones de toppings
        productoSeleccionado.toppings.forEach((topping, index) {
            const toppingDiv = document.createElement('div');
            toppingDiv.className = 'topping-checkbox';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = 'toppings';
            checkbox.value = topping.nombre;
            checkbox.id = `topping-${index}`;
            
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Desmarcar "Sin topping"
                    document.getElementById('topping-sin').checked = false;
                    
                    // Agregar topping a las opciones seleccionadas
                    if (!opcionesSeleccionadas.toppings) {
                        opcionesSeleccionadas.toppings = [];
                    }
                    opcionesSeleccionadas.toppings.push(topping.nombre);
                } else {
                    // Remover topping de las opciones seleccionadas
                    if (opcionesSeleccionadas.toppings) {
                        const index = opcionesSeleccionadas.toppings.indexOf(topping.nombre);
                        if (index > -1) {
                            opcionesSeleccionadas.toppings.splice(index, 1);
                        }
                        
                        // Si no hay toppings seleccionados, marcar "Sin topping"
                        if (opcionesSeleccionadas.toppings.length === 0) {
                            document.getElementById('topping-sin').checked = true;
                        }
                    }
                }
            });
            
            const label = document.createElement('label');
            label.htmlFor = `topping-${index}`;
            
            const toppingInfo = document.createElement('div');
            toppingInfo.className = 'topping-info';
            
            const toppingName = document.createElement('span');
            toppingName.className = 'topping-name';
            toppingName.textContent = topping.nombre;
            
            const toppingPrice = document.createElement('span');
            toppingPrice.className = 'topping-price';
            toppingPrice.textContent = `+$${topping.precio}`;
            
            toppingInfo.appendChild(toppingName);
            toppingInfo.appendChild(toppingPrice);
            label.appendChild(toppingInfo);
            
            toppingDiv.appendChild(checkbox);
            toppingDiv.appendChild(label);
            toppingsGroup.appendChild(toppingDiv);
        });
        
        formulario.appendChild(toppingsGroup);
        // Establecer valor por defecto
        opcionesSeleccionadas.toppings = [];
    }
    
    modal.classList.remove('modal-oculto');
}

// Cerrar modal de opciones
function cerrarModalOpciones() {
    document.getElementById('modal-opciones').classList.add('modal-oculto');
}

// Confirmar selecci√≥n y agregar al carrito
function confirmarSeleccion() {
    // Calcular precio adicional por opciones
    let precioAdicional = 0;
    let detallesVariables = [];
    
    // Procesar opciones de caf√©s y t√©s
    for (const [opcion, valor] of Object.entries(opcionesSeleccionadas)) {
        if (opcion !== 'toppings') {
            if (valor.includes('Deslactosada')) precioAdicional += 10;
            
            // Guardar detalles para mostrar en carrito
            if (valor.includes('Deslactosada')) {
                detallesVariables.push(`${opcion: ${valor}`);
            }
        }
    }
    
    // Procesar toppings
    if (opcionesSeleccionadas.toppings && opcionesSeleccionadas.toppings.length > 0) {
        opcionesSeleccionadas.toppings.forEach(toppingNombre => {
            // Encontrar el topping para obtener su precio
            const topping = productoSeleccionado.toppings.find(t => t.nombre === toppingNombre);
            if (topping) {
                precioAdicional += topping.precio;
                detallesVariables.push(`Topping: ${topping.nombre}`);
            }
        });
    }
    
    const precioTotal = productoSeleccionado.precio + precioAdicional;
    
    const itemCarrito = {
        ...productoSeleccionado,
        opciones: {...opcionesSeleccionadas},
        cantidad: 1,
        precioTotal: precioTotal,
        detallesVariables: detallesVariables
    };
    
    // Verificar si ya existe en el carrito
    const indexExistente = carrito.findIndex(item => 
        item.id === itemCarrito.id && 
        JSON.stringify(item.opciones) === JSON.stringify(itemCarrito.opciones)
    );
    
    if (indexExistente !== -1) {
        carrito[indexExistente].cantidad++;
        carrito[indexExistente].precioTotal += precioTotal;
    } else {
        carrito.push(itemCarrito);
    }
    
    guardarCarritoEnLocalStorage();
    actualizarCarrito();
    cerrarModalOpciones();
    
    // Efecto visual de confirmaci√≥n
    const carritoBtn = document.getElementById('carrito-btn');
    carritoBtn.classList.add('pulse-effect');
    setTimeout(() => {
        carritoBtn.classList.remove('pulse-effect');
    }, 500);
}

// Guardar carrito en localStorage
function guardarCarritoEnLocalStorage() {
    localStorage.setItem('sinnerCart', JSON.stringify(carrito));
}

// Cargar carrito desde localStorage
function cargarCarritoDesdeLocalStorage() {
    const carritoGuardado = localStorage.getItem('sinnerCart');
    if (carritoGuardado) {
        carrito = JSON.parse(carritoGuardado);
    }
}

// Actualizar carrito
function actualizarCarrito() {
    const contador = document.getElementById('contador');
    contador.textContent = carrito.reduce((total, item) => total + item.cantidad, 0);
}

// Abrir modal de carrito
function abrirModalCarrito() {
    const modal = document.getElementById('modal-carrito');
    const listaCarrito = document.getElementById('lista-carrito');
    const totalCarrito = document.getElementById('total-carrito');
    
    listaCarrito.innerHTML = '';
    
    if (carrito.length === 0) {
        listaCarrito.innerHTML = '<p class="carrito-vacio">Tu carrito est√° vac√≠o</p>';
        totalCarrito.textContent = 'Total: $0.00 MXN';
    } else {
        let total = 0;
        
        carrito.forEach((item, index) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'item-carrito';
            
            let detallesHTML = '';
            if (item.detallesVariables && item.detallesVariables.length > 0) {
                detallesHTML = `<div class="detalles-variables">`;
                item.detallesVariables.forEach(detalle => {
                    detallesHTML += `<div>${detalle}</div>`;
                });
                detallesHTML += `</div>`;
            }
            
            itemElement.innerHTML = `
                <div class="item-info">
                    <h4>${item.nombre}</h4>
                    ${detallesHTML}
                    <p class="precio-item">$${item.precioTotal}.00 MXN</p>
                </div>
                <div class="item-controles">
                    <button onclick="modificarCantidad(${index}, -1)">-</button>
                    <span>${item.cantidad}</span>
                    <button onclick="modificarCantidad(${index}, 1)">+</button>
                    <button onclick="eliminarItem(${index})">üóëÔ∏è</button>
                </div>
            `;
            listaCarrito.appendChild(itemElement);
            total += item.precioTotal;
        });
        
        totalCarrito.textContent = `Total: $${total}.00 MXN`;
    }
    
    modal.classList.remove('modal-oculto');
}

// Cerrar modal de carrito
function cerrarModalCarrito() {
    document.getElementById('modal-carrito').classList.add('modal-oculto');
}

// Modificar cantidad de items en carrito
function modificarCantidad(index, cambio) {
    const item = carrito[index];
    const precioUnitario = item.precioTotal / item.cantidad;
    
    if (cambio === 1) {
        item.cantidad++;
        item.precioTotal += precioUnitario;
    } else if (cambio === -1 && item.cantidad > 1) {
        item.cantidad--;
        item.precioTotal -= precioUnitario;
    }
    
    guardarCarritoEnLocalStorage();
    actualizarCarrito();
    abrirModalCarrito(); // Refrescar vista
}

// Eliminar item del carrito
function eliminarItem(index) {
    carrito.splice(index, 1);
    guardarCarritoEnLocalStorage();
    actualizarCarrito();
    
    if (carrito.length === 0) {
        cerrarModalCarrito();
    } else {
        abrirModalCarrito(); // Refrescar vista
    }
}

// Seleccionar combo
function seleccionarCombo(tipo) {
    comboSeleccionado = combos[tipo];
    opcionesComboSeleccionadas = {};
    mostrarModalCombo();
}

// Mostrar modal de combo
function mostrarModalCombo() {
    const modal = document.getElementById('modal-combo');
    const tituloCombo = document.getElementById('titulo-combo');
    const opcionesCombo = document.getElementById('opciones-combo');
    
    tituloCombo.textContent = `Personalizar ${comboSeleccionado.nombre}`;
    opcionesCombo.innerHTML = '';
    
    // Crear opciones para cada producto del combo
    comboSeleccionado.productos.forEach(nombreProducto => {
        // Buscar el producto en los datos
        let producto = null;
        for (const categoria in productos) {
            producto = productos[categoria].find(p => p.nombre === nombreProducto);
            if (producto) break;
        }
        
        if (producto) {
            const productoGroup = document.createElement('div');
            productoGroup.className = 'opcion-group';
            productoGroup.innerHTML = `<h3>${producto.nombre} (${producto.sabor})</h3>`;
            
            // Mostrar opciones para caf√©s and t√©s
            if (producto.opciones) {
                for (const [opcion, valores] of Object.entries(producto.opciones)) {
                    valores.forEach((valor, index) => {
                        const inputId = `combo-${producto.nombre}-${opcion}-${index}`;
                        
                        const div = document.createElement('div');
                        div.className = 'topping-checkbox';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = `${producto.nombre}-${opcion}`;
                        radio.value = valor;
                        radio.id = inputId;
                        radio.checked = index === 0;
                        
                        radio.addEventListener('change', function() {
                            if (!opcionesComboSeleccionadas[producto.nombre]) {
                                opcionesComboSeleccionadas[producto.nombre] = {};
                            }
                            opcionesComboSeleccionadas[producto.nombre][opcion] = valor;
                        });
                        
                        const label = document.createElement('label');
                        label.htmlFor = inputId;
                        label.textContent = valor.replace('(+$10)', '').trim();
                        
                        // Mostrar precio si existe
                        if (valor.includes('+$10')) {
                            const priceSpan = document.createElement('span');
                            priceSpan.className = 'topping-price';
                            priceSpan.textContent = '+$10';
                            label.appendChild(priceSpan);
                        }
                        
                        div.appendChild(radio);
                        div.appendChild(label);
                        productoGroup.appendChild(div);
                    });
                    
                    // Establecer valor por defecto
                    if (!opcionesComboSeleccionadas[producto.nombre]) {
                        opcionesComboSeleccionadas[producto.nombre] = {};
                    }
                    opcionesComboSeleccionadas[producto.nombre][opcion] = valores[0].replace('(+$10)', '').trim();
                }
            }
            
            // Mostrar toppings para todos los productos
            if (producto.toppings && producto.toppings.length > 0) {
                const toppingsTitle = document.createElement('h4');
                toppingsTitle.textContent = 'Toppings:';
                toppingsTitle.style.marginTop = '10px';
                toppingsTitle.style.color = '#ffd700';
                productoGroup.appendChild(toppingsTitle);
                
                producto.toppings.forEach((topping, toppingIndex) => {
                    const toppingDiv = document.createElement('div');
                    toppingDiv.className = 'topping-checkbox';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = `${producto.nombre}-toppings`;
                    checkbox.value = topping.nombre;
                    checkbox.id = `combo-${producto.nombre}-topping-${toppingIndex}`;
                    
                    checkbox.addEventListener('change', function() {
                        if (!opcionesComboSeleccionadas[producto.nombre]) {
                            opcionesComboSeleccionadas[producto.nombre] = {};
                        }
                        if (!opcionesComboSeleccionadas[producto.nombre].toppings) {
                            opcionesComboSeleccionadas[producto.nombre].toppings = [];
                        }
                        
                        if (this.checked) {
                            opcionesComboSeleccionadas[producto.nombre].toppings.push(topping.nombre);
                        } else {
                            const index = opcionesComboSeleccionadas[producto.nombre].toppings.indexOf(topping.nombre);
                            if (index > -1) {
                                opcionesComboSeleccionadas[producto.nombre].toppings.splice(index, 1);
                            }
                        }
                    });
                    
                    const label = document.createElement('label');
                    label.htmlFor = `combo-${producto.nombre}-topping-${toppingIndex}`;
                    
                    const toppingInfo = document.createElement('div');
                    toppingInfo.className = 'topping-info';
                    
                    const toppingName = document.createElement('span');
                    toppingName.className = 'topping-name';
                    toppingName.textContent = topping.nombre;
                    
                    const toppingPrice = document.createElement('span');
                    toppingPrice.className = 'topping-price';
                    toppingPrice.textContent = `+$${topping.precio}`;
                    
                    toppingInfo.appendChild(toppingName);
                    toppingInfo.appendChild(toppingPrice);
                    label.appendChild(toppingInfo);
                    
                    toppingDiv.appendChild(checkbox);
                    toppingDiv.appendChild(label);
                    productoGroup.appendChild(toppingDiv);
                });
            }
            
            opcionesCombo.appendChild(productoGroup);
        }
    });
    
    modal.classList.remove('modal-oculto');
}

// Cerrar modal de combo
function cerrarModalCombo() {
    document.getElementById('modal-combo').classList.add('modal-oculto');
}

// Confirmar combo y agregar al carrito
function confirmarCombo() {
    // Calcular precio adicional por opciones
    let precioAdicional = 0;
    let detallesCombo = [];
    
    for (const [nombreProducto, opciones] of Object.entries(opcionesComboSeleccionadas)) {
        // Procesar opciones regulares
        for (const [opcion, valor] of Object.entries(opciones)) {
            if (opcion !== 'toppings') {
                if (valor.includes('Deslactosada')) precioAdicional += 10;
                
                // Guardar detalles para mostrar en carrito
                if (valor.includes('Deslactosada')) {
                    detallesCombo.push(`${nombreProducto}: ${valor}`);
                }
            }
        }
        
        // Processar toppings
        if (opciones.toppings && opciones.toppings.length > 0) {
            opciones.toppings.forEach(toppingNombre => {
                // Buscar el producto para encontrar el topping
                let producto = null;
                for (const categoria in productos) {
                    producto = productos[categoria].find(p => p.nombre === nombreProducto);
                    if (producto) break;
                }
                
                if (producto && producto.toppings) {
                    const topping = producto.toppings.find(t => t.nombre === toppingNombre);
                    if (topping) {
                        precioAdicional += topping.precio;
                        detallesCombo.push(`${nombreProducto}: ${topping.nombre}`);
                    }
                }
            });
        }
    }
    
    const precioTotal = comboSeleccionado.precioBase + precioAdicional;
    
    const itemCarrito = {
        id: `combo-${comboSeleccionado.nombre}`,
        nombre: comboSeleccionado.nombre,
        descripcion: comboSeleccionado.descripcion,
        opciones: {...opcionesComboSeleccionadas},
        cantidad: 1,
        precioTotal: precioTotal,
        detallesVariables: detallesCombo,
        esCombo: true,
        cuentaComoTres: true // Marcar que cuenta como 3 productos
    };
    
    carrito.push(itemCarrito);
    guardarCarritoEnLocalStorage();
    actualizarCarrito();
    cerrarModalCombo();
    
    // Efecto visual de confirmaci√≥n
    const carritoBtn = document.getElementById('carrito-btn');
    carritoBtn.classList.add('pulse-effect');
    setTimeout(() => {
        carritoBtn.classList.remove('pulse-effect');
    }, 500);
}

// Funciones para los modales de ubicaci√≥n
function mostrarSeleccionUbicacion() {
    if (carrito.length === 0) {
        alert('Agrega al menos un producto al carrito primero');
        return;
    }
    
    // Verificar pedido m√≠nimo de 3 productos
    const totalProductos = carrito.reduce((total, item) => total + (item.cuentaComoTres ? 3 : item.cantidad), 0);
    if (totalProductos < 3) {
        alert('PEDIDO M√çNIMO: Debes agregar al menos 3 productos para realizar tu pedido.');
        document.getElementById('alerta-minimo').style.display = 'flex';
        return;
    }
    
    document.getElementById('modal-carrito').classList.add('modal-oculto');
    document.getElementById('modal-ubicacion').classList.remove('modal-oculto');
    
    // Establecer direcci√≥n por defecto
    direccionSeleccionada = "Calle Coral 120, colonia Estrella, CDMX";
}

function cerrarModalUbicacion() {
    document.getElementById('modal-ubicacion').classList.add('modal-oculto');
}

function abrirGoogleMaps() {
    const ubicacionRadio = document.querySelector('input[name="ubicacion"]:checked');
    const address = ubicacionRadio.value;
    window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
}

function mostrarInstruccionesPago() {
    const ubicacionRadio = document.querySelector('input[name="ubicacion"]:checked');
    direccionSeleccionada = ubicacionRadio.value;
    
    document.getElementById('modal-ubicacion').classList.add('modal-oculto');
    
    // Mostrar la direcci√≥n seleccionada en el modal de pago
    document.getElementById('direccion-confirmacion').textContent = `üìç ${direccionSeleccionada}`;
    
    document.getElementById('modal-pago').classList.remove('modal-oculto');
}

function cerrarModalPago() {
    document.getElementById('modal-pago').classList.add('modal-oculto');
}

function regresarADireccion() {
    document.getElementById('modal-pago').classList.add('modal-oculto');
    document.getElementById('modal-ubicacion').classList.remove('modal-oculto');
}

function enviarPedidoWhatsApp() {
    if (carrito.length === 0) {
        alert('No hay items en el carrito');
        return;
    }
    
    // Verificar pedido m√≠nimo de 3 productos
    const totalProductos = carrito.reduce((total, item) => total + (item.cuentaComoTres ? 3 : item.cantidad), 0);
    if (totalProductos < 3) {
        alert('PEDIDO M√çNIMO: Debes agregar al menos 3 productos para realizar tu pedido.');
        document.getElementById('alerta-minimo').style.display = 'flex';
        return;
    }
    
    let mensaje = "¬°Hola! Quiero realizar el siguiente pedido:%0A%0A";
    
    carrito.forEach(item => {
        if (item.esCombo) {
            // Formato para combos
            mensaje += `- COMBO: ${item.nombre}%0A`;
            mensaje += `  ${item.descripcion}%0A`;
            
            // Agregar detalles de variables para combos
            if (item.detallesVariables && item.detallesVariables.length > 0) {
                item.detallesVariables.forEach(detalle => {
                    mensaje += `  ¬∑ ${detalle}%0A`;
                });
            }
            
            mensaje += `  x${item.cantidad} - $${item.precioTotal}%0A%0A`;
        } else {
            // Formato para productos individuales
            mensaje += `- ${item.nombre}`;
            
            // Agregar detalles de variables
            if (item.detallesVariables && item.detallesVariables.length > 0) {
                item.detallesVariables.forEach(detalle => {
                    mensaje += `%0A  ¬∑ ${detalle}`;
                });
            }
            
            mensaje += `%0A  x${item.cantidad} - $${item.precioTotal}%0A%0A`;
        }
    });
    
    const total = carrito.reduce((sum, item) => sum + item.precioTotal, 0);
    mensaje += `%0ATotal: $${total} MXN%0A%0A`;
    mensaje += `Direcci√≥n: ${direccionSeleccionada}%0A%0A`;
    mensaje += "Datos bancarios:%0A";
    mensaje += "Titular: Eric Daniel Guti√©rrez Arana%0A";
    mensaje += "CLABE: 012 261 01584933343 3 (BBVA)%0A%0A";
    mensaje += "Al momento de realizar el pedido se confirmar√° la preparaci√≥n del mismo una vez que se adjunte el comprobante de pago; en el CONCEPTO de la transferencia COLOCA TU NOMBRE o el NOMBRE DE LA PERSONA que realizar√° la recolecci√≥n%0A%0A";
    mensaje += "¬°Gracias!";
    
    window.open(`https://wa.me/5215611649344?text=${mensaje}`, '_blank');
    
    // Limpiar carrito despu√©s de enviar
    carrito = [];
    guardarCarritoEnLocalStorage();
    actualizarCarrito();
    cerrarModalPago();
}
